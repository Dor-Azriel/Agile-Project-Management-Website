pipeline {
    agent { docker { image 'python:3.7' } }
    triggers {
      githubPush()
  }

    stages {
        stage('Build') {
            steps {
                sh 'python --version'
            }

        }
        stage('setup'){
          steps{
        if (fileExists('requirements/preinstall.txt')) {
            sh """
          . .env/bin/activate
          pip install -r requirements/preinstall.txt
             """
}
...
sh """
. .env/bin/activate
pip install -r requirements/test.txt
"""
}
stage("Unittests") {
    sh """
    . .env/bin/activate
    ./manage.py test --noinput
    """
}
          }

        }

    }

}